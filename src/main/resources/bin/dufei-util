#!/usr/bin/env bash
cur=$(cd `dirname $0`; pwd)
cd $cur/..

JAVA_CMD="java -cp ./conf:./bin:./dufei-utilities-1.0.jar"
if [ $JAVA_HOME ]; then
    JAVA_CMD="$JAVA_HOME/bin/$JAVA_CMD"
fi
JAVA_ARGS=""
MAIN="person.dufei.utils.main.Model2RequestJsonMain"

ARGS=`getopt -o u:t:f:s:b:a:c: --long model2req,tsv2req,tsv2score,model-url:,token:,tsv-file:,schema-json:,batch-size:,as-endpoint:,concurrency: -- "$@"`
if [ $? != 0 ]; then
    echo "terminating..."
    exit 1
fi

`set -- "$ARGS"`

while [ -n "$1" ]; do
    case "$1" in
        --model2req) MAIN="person.dufei.utils.main.Model2RequestJsonMain" ; shift 1 ;;
        --tsv2req) MAIN="person.dufei.utils.main.TSV2RequestJsonMain" ; shift 1 ;;
        --tsv2score) MAIN="person.dufei.utils.main.TSV2PredictionScoreMain" ; shift 1 ;;
        -u|--model-url) JAVA_ARGS="$JAVA_ARGS -DmodelUrl=$2" ; shift 2 ;;
        -t|--token) JAVA_ARGS="$JAVA_ARGS -DaccessToken=$2" ; shift 2 ;;
        -f|--tsv-file) JAVA_ARGS="$JAVA_ARGS -DtsvPath=$2" ; shift 2 ;;
        -s|--schema-json) JAVA_ARGS="$JAVA_ARGS -DschemaJson=$2" ; shift 2 ;;
        -b|--batch-size) JAVA_ARGS="$JAVA_ARGS -DbatchSize=$2" ; shift 2 ;;
        -a|--as-endpoint) JAVA_ARGS="$JAVA_ARGS -DasEndpoint=$2" ; shift 2 ;;
        -c|--concurrency) JAVA_ARGS="$JAVA_ARGS -Dconcurrency=$2" ; shift 2 ;;
        --) shift ; break ;;
        *) echo "unknown argument $1, terminating..." ; exit 1 ;;
    esac
done

$JAVA_CMD $JAVA_ARGS $MAIN
