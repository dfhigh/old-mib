#!/usr/bin/env bash
cur=$(cd `dirname $0`; pwd)
cd $cur/..

JAVA_CMD="java -cp ./conf:./bin:./mib-1.1.jar"
if [ $JAVA_HOME ]; then
    JAVA_CMD="$JAVA_HOME/bin/$JAVA_CMD"
fi
JAVA_ARGS=""
MAIN="person.dufei.utils.main.Model2RequestJsonMain"

ARGS=`getopt -o h:u:t:f:s:b:a:c:l:o:d: --long tsv2req,tsv2score,model-url:,token:,tsv-file:,schema-json:,batch-size:,as-endpoint:,concurrency:,log-path:,service:,operation:,endpoint:,status:,start:,end:,profile,log2stats,sleep:,output-path:,first-line-schema,forever,delimiter:,async,help,kafka,kafka-endpoints:,kafka-topics: -- "$@"`
if [ $? != 0 ]; then
    echo "terminating..."
    exit 1
fi

`set -- "$ARGS"`

while [ -n "$1" ]; do
    case "$1" in
        --tsv2req) MAIN="person.dufei.utils.main.TSV2RequestJsonMain" ; shift 1 ;;
        --log2stats) MAIN="person.dufei.utils.main.ServiceLogAnalyzeMain" ; shift 1 ;;
        --profile) MAIN="person.dufei.utils.main.PredictorProfileMain" ; shift 1 ;;
        --kafka) MAIN="person.dufei.utils.main.KafkaMessageLoggerMain" ; shift 1 ;;
        -u|--model-url) JAVA_ARGS="$JAVA_ARGS -DmodelUrl=$2" ; shift 2 ;;
        -t|--token) JAVA_ARGS="$JAVA_ARGS -DaccessToken=$2" ; shift 2 ;;
        -f|--tsv-file) JAVA_ARGS="$JAVA_ARGS -DtsvPath=$2" ; shift 2 ;;
        -s|--schema-json) JAVA_ARGS="$JAVA_ARGS -DschemaJson=$2" ; shift 2 ;;
        -b|--batch-size) JAVA_ARGS="$JAVA_ARGS -DbatchSize=$2" ; shift 2 ;;
        -a|--as-endpoint) JAVA_ARGS="$JAVA_ARGS -DasEndpoint=$2" ; shift 2 ;;
        -c|--concurrency) JAVA_ARGS="$JAVA_ARGS -Dconcurrency=$2" ; shift 2 ;;
        -l|--log-path) JAVA_ARGS="$JAVA_ARGS -DlogPath=$2" ; shift 2 ;;
        -o|--output-path) JAVA_ARGS="$JAVA_ARGS -DoutputPath=$2" ; shift 2 ;;
        -d|--delimiter) JAVA_ARGS="$JAVA_ARGS -Ddelimiter=$2" ; shift 2 ;;
        -h|--help) JAVA_ARGS="$JAVA_ARGS -Dhelp=true" ; shift 1 ;;
        --first-line-schema) JAVA_ARGS="$JAVA_ARGS -DfirstLineSchema=true" ; shift 1 ;;
        --forever) JAVA_ARGS="$JAVA_ARGS -Dforever=true" ; shift 1 ;;
        --async) JAVA_ARGS="$JAVA_ARGS -Dasync=true" ; shift 1 ;;
        --service) JAVA_ARGS="$JAVA_ARGS -Dservice=$2" ; shift 2 ;;
        --operation) JAVA_ARGS="$JAVA_ARGS -Doperation=$2" ; shift 2 ;;
        --endpoint) JAVA_ARGS="$JAVA_ARGS -Dendpoint=$2" ; shift 2 ;;
        --sleep) JAVA_ARGS="$JAVA_ARGS -Dsleep=$2" ; shift 2 ;;
        --status) JAVA_ARGS="$JAVA_ARGS -Dstatus=$2" ; shift 2 ;;
        --start) JAVA_ARGS="$JAVA_ARGS -DstartDate=$2" ; shift 2 ;;
        --end) JAVA_ARGS="$JAVA_ARGS -DendDate=$2" ; shift 2 ;;
        --kafka-endpoints) JAVA_ARGS="$JAVA_ARGS -DkafkaEndpoints=$2" ; shift 2 ;;
        --kafka-topics) JAVA_ARGS="$JAVA_ARGS -DkafkaTopics=$2" ; shift 2 ;;
        --) shift ; break ;;
        *) echo "unknown argument $1, terminating..." ; exit 1 ;;
    esac
done

$JAVA_CMD $JAVA_ARGS $MAIN
